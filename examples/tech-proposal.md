# 示例：实时日志聚合与告警方案（摘录）

## 摘要
- 目标：在 2 个月内为核心服务提供统一日志聚合与实时告警，99.9% 可用。
- 推荐：基于 Loki + Promtail + Alertmanager，单租户模式，分区部署。
- 行动：本周完成 PoC，T+3 周灰度，T+8 周全量；Owner：SRE。

## 约束与需求
- 约束：日均 2TB 日志、峰值 5x；只用内部云；预算 < ¥30k/月。
- 成功标准：查询 P95 < 2s，告警延迟 < 30s，丢失率 < 0.01%。

## 选项对比（摘要）
| 选项 | 优点 | 缺点 | 适用前提 |
| --- | --- | --- | --- |
| Loki | 成本低，标签查询友好 | 复杂查询弱 | 日志结构化程度中等 |
| Elasticsearch | 查询强大 | 成本高、运维复杂 | 预算充足，需全文检索 |

## 推荐方案要点
- 架构：Promtail 采集 → Loki 存储（S3 + BoltDB Shipper）→ Alertmanager。
- 关键配置：多租户隔离、日志采样率 90% 以上保留关键服务全量。
- 监控与回滚：部署健康检查、写入失败自动降级到本地文件。
